{"version":3,"sources":["app.min.js"],"names":["angular","module","run","$state","$ionicPlatform","$ionicScrollDelegate","$document","$window","$rootScope","$filter","$ionicLoading","$timeout","Utils","Cloud","Watch","ready","open","url","window","SafariViewController","isAvailable","available","show","tintColor","barColor","controlTintColor","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleLightContent","backgroundColorByHexString","element","on","scrollTop","geofence","hasGeofence","startGeofence","callback","initialize","then","getWatched","fences","geoFences","JSON","parse","handleGeofence","geofences","notification","$apply","forEach","geo","data","id","split","controller","controllers","mac","door","toggleDoor","auth","onTransitionReceived","onNotificationClicked","ThreeDeeTouch","updateQuickLinks","enableLinkPreview","onHomeIconPressed","payload","type","applewatch","navigator","simulator","init","noop","toggleDoorByIndex","index","onLoadAppMainRequest","loadApp","splashscreen","hide","err","connected","version","appVersion","loadingQueue","$on","e","scope","$new","canceller","resolve","$broadcast","push","template","pop","length","title","checkNewController","sync","firstLoadHandler","event","preventDefault","storage","get","activeController","Object","keys","go","updateController","cloudToken","content","document","getElementById","innerWidth","width","config","$stateProvider","$urlRouterProvider","$httpProvider","$compileProvider","$ionicConfigProvider","test","userAgent","platform","default","spinner","icon","backButton","previousTitleText","text","scrolling","jsScrolling","aHrefSanitizationWhitelist","imgSrcSanitizationWhitelist","state","templateUrl","abstract","views","menuContent","checkValid","$q","total","filterFilter","invalidOrg","remove","reject","setController","interceptors","$injector","request","match","cancel","defer","timeout","promise","retryCount","suppressLoader","response","responseError","error","$$state","status","canceled","$http","retryFailed","forwardCache","filter","items","filterOn","isUndefined","isArray","newItems","extractValueToCompare","item","isObject","isString","isDuplicate","i","equals","directive","restrict","replace","rule","link","map","marker","circle","updateRule","addOrUpdate","direction","latitude","start","lat","longitude","lng","radius","transitionType","openAppOnClick","updateMarker","setMap","google","maps","Marker","position","updateRadius","Circle","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","center","parseInt","updateMap","enable","setTimeout","Map","querySelectorAll","zoom","streetViewControl","mapTypeControl","addListener","latLng","$watch","currentRule","geolocation","getCurrentPosition","coords","factory","$httpParamSerializerJQLike","$ionicPopup","$ionicActionSheet","requestAuth","buttons","onTap","username","password","isValid","login","syncStart","user","pass","method","headers","Content-Type","action","result","token","set","cloudDataToken","sjcl","codec","hex","fromBits","hash","sha256","isSynced","loggedin","getSites","sites","stringify","finish","saveSites","titleText","cancelText","buttonClicked","concat","local","undefined","handleInvalidDataToken","controllerType","success","message","handleExpiredLogin","decrypt","encodeURIComponent","encrypt","prompt","subTitle","inputType","inputPlaceholder","confirm","logout","getTokenUser","atob","$scope","submit","alert","skipCloud","$ionicModal","$ionicHistory","showDelete","selectPhoto","nextViewOptions","historyRoot","deleteController","getControllerIndex","splice","moveItem","fromIndex","toIndex","getTime","timestamp","Date","toLocaleString","changeSync","getLogs","reply","current","day","isLocal","toDateString","isDivider","logs","settings","changePassword","restart","restartController","saveOptions","getControllerOptions","mod","fwv","$ionicSideMenuDelegate","sideMenuDraggable","showAddController","showAddBlynk","closeMenu","toggleLeft","interval","currentIndex","changeController","to","clearInterval","setInterval","reset","home","away","isAndroid","ionic","Platform","isFireFox","isIE","query","hasOwnProperty","localStorage","getItem","setItem","removeItem","getControllerSettings","ip","all","name","lastUpdate","updatedAt","showLoader","copy","extend","addController","join","ssids","save","modal","connectNewController","fromTemplateUrl","animation","ssid","saveNewController","int","links","limit","iconType","configureQuickActions","cancelPendingHttp","pendingRequests","pendingReq","HTMLElement","prototype","click","evt","this","ownerDocument","createEvent","initMouseEvent","defaultView","dispatchEvent","canScan","networkinterface","scan","foundControllers","getIPAddress","router","baseip","check","matches","catch","queue","popup","close","cdt","params","paramSerializer","pwd","nkey","ckey","indexOf","sort","a","b","$event","deletePhoto","fileInput","image","cropped","uploadPhoto","crop","stopPropagation","parent","one","file","files","reader","FileReader","onload","target","readAsDataURL","loadAppMain","label","value","color","font","size","table","alpha","rows","makeAppList","group","backgroundColor","cornerRadius","canvas","createElement","ctx","getContext","img","Image","src","height","drawImage","imageLeft","toDataURL"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular, google */\n\n// OpenGarage\n// Controllers are found in controllers.js and utilities are located in utils.js\nangular.module( \"opengarage\", [ \"ionic\", \"uiCropper\", \"opengarage.controllers\", \"opengarage.utils\", \"opengarage.cloud\", \"opengarage.watch\" ] )\n\t.run( function( $state, $ionicPlatform, $ionicScrollDelegate, $document, $window, $rootScope, $filter, $ionicLoading, $timeout, Utils, Cloud, Watch ) {\n\n\t\t// Ready function fires when the DOM is ready and after deviceready event is fired if Cordova is being used\n\t\t$ionicPlatform.ready( function() {\n\n\t\t\t// Map inAppBrowser to rootScope\n\t\t\t$rootScope.open = function( url ) {\n\t\t\t\tif ( window.SafariViewController ) {\n\t\t\t\t\twindow.SafariViewController.isAvailable( function( available ) {\n\t\t\t\t\t\tif ( available ) {\n\t\t\t\t\t\t\twindow.SafariViewController.show( {\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\ttintColor: \"#444444\",\n\t\t\t\t\t\t\t\tbarColor: \"#444444\",\n\t\t\t\t\t\t\t\tcontrolTintColor: \"#ffffff\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n\t\t\t// for form inputs)\n\t\t\tif ( window.cordova && window.cordova.plugins && window.cordova.plugins.Keyboard && window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar ) {\n\t\t\t\twindow.cordova.plugins.Keyboard.hideKeyboardAccessoryBar( true );\n\t\t\t}\n\t\t\tif ( window.StatusBar ) {\n\n\t\t\t\t// Use white text/icons on the status bar\n\t\t        window.StatusBar.styleLightContent();\n\n\t\t        //Change the status bar color to match the header\n                window.StatusBar.backgroundColorByHexString( \"#444\" );\n\n\t\t        // Scroll to the top of the page when the status bar is tapped\n\t\t\t\tangular.element( $window ).on( \"statusTap\", function() {\n\t\t\t\t\t$ionicScrollDelegate.scrollTop();\n\t\t        } );\n\t\t\t}\n\n\t\t\tif ( window.geofence ) {\n\t\t\t\t$rootScope.hasGeofence = true;\n\n\t\t\t\t$rootScope.startGeofence = function( callback ) {\n\t\t\t\t\twindow.geofence.initialize().then( function() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t} );\n\n\t\t\t\tvar handleGeofence = function( geofences ) {\n\t\t\t\t\tif ( geofences ) {\n\n\t\t\t\t\t\t// Allow handler to process notification click event as well\n\t\t\t\t\t\tif ( geofences.notification ) {\n\t\t\t\t\t\t\tgeofences = [ geofences ];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.$apply( function() {\n\t\t\t\t\t\t\tgeofences.forEach( function( geo ) {\n\t\t\t\t\t\t\t\tvar data = geo.notification.id.split( \"-\" ),\n\t\t\t\t\t\t\t\t\tcontroller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": data[ 1 ] } );\n\n\t\t\t\t\t\t\t\tif ( controller &&\n\t\t\t\t\t\t\t\t\t( data[ 0 ] === \"open\" && controller.door === 0 ) &&\n\t\t\t\t\t\t\t\t\t( data[ 0 ] === \"close\" && controller.door === 1 ) ) {\n\t\t\t\t\t\t\t\t\t\tUtils.toggleDoor( controller.auth );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.onTransitionReceived = handleGeofence;\n\t\t\t\twindow.geofence.onNotificationClicked = handleGeofence;\n\t\t\t}\n\n\t\t\tif ( window.ThreeDeeTouch ) {\n\t\t\t\tUtils.updateQuickLinks();\n\n\t\t\t\twindow.ThreeDeeTouch.enableLinkPreview();\n\n\t\t\t\twindow.ThreeDeeTouch.onHomeIconPressed = function( payload ) {\n\n\t\t\t\t\tvar data = payload.type.split( \"-\" );\n\n\t\t\t\t\tif ( data[ 0 ] === \"toggle\" ) {\n\t\t\t\t\t\tvar controller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": data[ 1 ] } );\n\t\t\t\t\t\tif ( controller ) {\n\t\t\t\t\t\t\tUtils.toggleDoor( controller.auth );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif ( window.applewatch && window.navigator.simulator !== true ) {\n\t\t\t\twindow.applewatch.init( angular.noop );\n\n\t\t\t\twindow.toggleDoorByIndex = function( index ) {\n\t\t\t\t\tUtils.toggleDoor( $rootScope.controllers[ index ].auth );\n\t\t\t\t};\n\n\t\t\t\twindow.applewatch.callback.onLoadAppMainRequest = Watch.loadApp;\n\t\t\t}\n\n\t\t    // Hide the splash screen after 500ms of the app being ready\n\t\t    $timeout( function() {\n\t\t        try {\n\t\t            navigator.splashscreen.hide();\n\t\t        } catch ( err ) {}\n\t\t    }, 500 );\n\t\t} );\n\n\t\t// Define connected state of current controller\n\t\t$rootScope.connected = false;\n\n\t\t// Define version, build number and debug state\n\t\t$rootScope.version = window.appVersion;\n\n\t    // Define total loading requests\n\t    $rootScope.loadingQueue = [];\n\n\t    // Initialize controllers array\n\t    $rootScope.controllers = [];\n\n\t\t// Automatically show a loading message on any AJAX request\n\t\t$rootScope.$on( \"loading:show\", function( e, data ) {\n\t\t\tvar scope = $rootScope.$new();\n\n\t\t\tscope.canceller = data ? data.canceller.resolve : function() {\n\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t};\n\n\t\t\t$rootScope.loadingQueue.push( scope.canceller );\n\t\t\t$ionicLoading.show( {\n\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='canceller()'>Cancel</button>\",\n\t\t\t\tscope: scope\n\t\t\t} );\n\t\t} );\n\n\t\t// Automatically hide the loading message after an AJAX request\n\t\t$rootScope.$on( \"loading:hide\", function() {\n\n\t\t\t$rootScope.loadingQueue.pop();\n\t\t\t$ionicLoading.hide();\n\t\t\tif ( $rootScope.loadingQueue.length > 0 ) {\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.canceller = $rootScope.loadingQueue[ $rootScope.loadingQueue.length - 1 ];\n\t\t\t\t$ionicLoading.show( {\n\t\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='canceller()'>Cancel</button>\",\n\t\t\t\t\tscope: scope\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\t// Keep the page title locked as the app name\n\t\t$rootScope.$on( \"$ionicView.afterEnter\", function() {\n\t\t\t$document[ 0 ].title = \"OpenGarage\";\n\t\t} );\n\n\t\tangular.element( $document ).on( \"resume\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\tUtils.checkNewController();\n\t\t\t\tCloud.sync();\n\t\t\t}, 100 );\n\t\t} );\n\n\t\t// Handle loading of the first page\n\t\tvar firstLoadHandler = $rootScope.$on( \"$stateChangeStart\", function( event ) {\n\n\t\t\t// Unbind event handler so this check is only performed on the first app load\n\t\t    firstLoadHandler();\n\n\t\t    // Prevent any page change from occurring\n\t        event.preventDefault();\n\n\t\t    Utils.storage.get( [ \"activeController\", \"controllers\", \"cloudToken\" ], function( data ) {\n\n\t\t\t\ttry {\n\t\t\t\t\t$rootScope.controllers = JSON.parse( data.controllers );\n\t\t\t\t\t$rootScope.activeController = JSON.parse( data.activeController );\n\t\t\t\t} catch ( err ) {}\n\n\t\t\t\tif ( !$rootScope.controllers ) {\n\t\t\t\t\t$rootScope.controllers = [];\n\t\t\t\t}\n\n\t\t\t\tif ( !$rootScope.activeController || typeof $rootScope.activeController !== \"object\" ) {\n\t\t\t\t\t$rootScope.activeController = {};\n\t\t\t\t}\n\n\t\t\t\tCloud.sync();\n\n\t\t\t\t// Restore the active controller, if available\n\t\t        if ( Object.keys( $rootScope.activeController ).length ) {\n\n\t\t\t\t\t// If a user object is cached, proceed to load the app while updating user object in the background\n\t\t\t\t\t$state.go( \"app.home\" );\n\n\t\t\t\t\tUtils.updateController();\n\t\t        } else {\n\t\t\t\t\tif ( $rootScope.controllers.length || data.cloudToken ) {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"login\" );\n\t\t\t\t\t}\n\t\t        }\n\t\t    } );\n\n\t\t    Utils.checkNewController();\n\t\t} );\n\n\t\t// Resize the main content view to fit when the window changes size\n\t\tangular.element( window ).on( \"resize\", function() {\n\t\t\t$rootScope.$broadcast( \"window:resize\" );\n\t\t\tvar content = document.getElementById( \"mainContent\" );\n\t\t\tif ( content && window.innerWidth > 768 ) {\n\t\t\t\tcontent.width = window.innerWidth - 275;\n\t\t\t}\n\t\t} );\n\t} )\n\n\t.config( function( $stateProvider, $urlRouterProvider, $httpProvider, $compileProvider, $ionicConfigProvider ) {\n\n\t\tif ( /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ) ) {\n\n\t\t\t// Change the default spinner for IE to android which has JS based animation\n\t\t\t$ionicConfigProvider.platform.default.spinner.icon( \"android\" );\n\t\t}\n\n\t\t// Change the back text to always say 'Back'\n\t\t$ionicConfigProvider.backButton.previousTitleText( false ).text( \"Back\" );\n\n\t\t// Use native scrolling for FireFox\n\t\tif ( /Firefox/.test( navigator.userAgent ) ) {\n\t\t\t$ionicConfigProvider.scrolling.jsScrolling( false );\n\t\t}\n\n\t\t// Modify Ionic's allowed href protocols to allow Firefox, Blackberry, iOS and Chrome support\n\t\t$compileProvider.aHrefSanitizationWhitelist( /^\\s*(https?|ftp|mailto|chrome-extension|app|local|file):/ );\n\n\t\t// Modify Ionic's allowed image source protocols\n\t\t$compileProvider.imgSrcSanitizationWhitelist( /^\\s*(https?|ftp|file|content|blob|ms-appx|x-wmapp0|chrome-extension|app|local):|data:image\\// );\n\n\t\t// Define all available routes and their associated controllers\n\t\t$stateProvider\n\t\t\t.state( \"login\", {\n\t\t\t\turl: \"/login\",\n\t\t\t\ttemplateUrl: \"templates/login.html\",\n\t\t\t\tcontroller: \"LoginCtrl\"\n\t\t\t} )\n\n\t\t\t// Used as the parent route after authentication is complete allowing the same header\n\t\t\t// and side menu's to be used throughout all child views\n\t\t\t.state( \"app\", {\n\t\t\t\turl: \"/app\",\n\t\t\t\tabstract: true,\n\t\t\t\ttemplateUrl: \"templates/menu.html\",\n\t\t\t\tcontroller: \"MenuCtrl\"\n\t\t\t} )\n\n\t\t\t.state( \"app.home\", {\n\t\t\t\turl: \"/home\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/home.html\",\n\t\t\t\t\t\tcontroller: \"HomeCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $timeout, $q, $state, $rootScope, $filter, Utils ) {\n\t\t\t\t\t\tvar total = $rootScope.controllers.length,\n\t\t\t\t\t\t\tfilterFilter = $filter( \"filter\" ),\n\t\t\t\t\t\t\tinvalidOrg = ( $rootScope.activeController && filterFilter( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ).length === 0 ) ? true : false;\n\n\t\t\t\t\t\tif ( !$rootScope.activeController && total === 1 ) {\n\t\t\t\t\t\t\tUtils.setController( 0 );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !$rootScope.activeController || invalidOrg ) {\n\n\t\t\t\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\t\t\t\tUtils.storage.remove( \"activeController\" );\n\n\t\t\t\t\t\t\t// If the active controller is not found in the controller list, show the select controller screen\n\t\t\t\t\t\t\t$timeout( function() {\n\t\t\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.rules\", {\n\t\t\t\turl: \"/rules\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/rules.html\",\n\t\t\t\t\t\tcontroller: \"RulesCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.controllerSelect\", {\n\t\t\t\turl: \"/controllerSelect\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/controllerSelect.html\",\n\t\t\t\t\t\tcontroller: \"ControllerSelectCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.history\", {\n\t\t\t\turl: \"/history\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/history.html\",\n\t\t\t\t\t\tcontroller: \"HistoryCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.settings\", {\n\t\t\t\turl: \"/settings\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/settings.html\",\n\t\t\t\t\t\tcontroller: \"SettingsCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.help\", {\n\t\t\t\turl: \"/help\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/help.html\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t// Defines the otherwise route which will redirect any invalid URL back to the start page\n\t\t\t.state( \"otherwise\", {\n\t\t\t\turl: \"*path\",\n\t\t\t\ttemplate: \"\",\n\t\t\t\tcontroller: function( $state, $rootScope ) {\n\n\t\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Add an HTTP interceptor\n\t\t$httpProvider.interceptors.push( function( $rootScope, $q, $injector ) {\n\t\t\treturn {\n\t\t\t\trequest: function( config ) {\n\n\t\t\t\t\t// When an AJAX request to the controller is started, fire an event to show a loading message\n\t\t\t\t\tif ( config.url.match( /^https?/ ) ) {\n\n\t\t\t\t\t\t// Change timeout to a promise we can cancel\n\t\t\t\t\t\tconfig.cancel = $q.defer();\n\n\t\t\t\t\t\t// Set the timeout to the canceller promise\n\t\t\t\t\t\tconfig.timeout = config.cancel.promise;\n\n\t\t\t\t\t\t// Set the current retry count to 0\n\t\t\t\t\t\tif ( typeof config.retryCount !== \"number\" ) {\n\t\t\t\t\t\t\tconfig.retryCount = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !config.suppressLoader ) {\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\", { canceller: config.cancel } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn config;\n\t\t\t\t},\n\t\t\t\tresponse: function( response ) {\n\n\t\t\t\t\t// If the request is to the controller, broadcast a hide loading message\n\t\t\t\t\tif ( !response.config.suppressLoader && response.config.url.match( /^https?/ ) ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t\tresponseError: function( error ) {\n\n\t\t\t\t\t// If the timeout value is an object and is resolved, mark request as user canceled\n\t\t\t\t\tif ( error.config.timeout && error.config.timeout.$$state && error.config.timeout.$$state.status === 1 ) {\n\t\t\t\t\t\terror.canceled = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !error.config.suppressLoader && error.config.url.match( /^https?/ ) ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the request timed out and is not user canceled, retry the request up to three times\n\t\t\t\t\tif ( error.status <= 0 && !error.canceled ) {\n\t\t\t\t\t\tif ( error.config.retryCount < 3 ) {\n\t\t\t\t\t\t\tvar $http = $injector.get( \"$http\" );\n\n\t\t\t\t\t\t\terror.config.retryCount++;\n\n\t\t\t\t\t\t\t// Return the new promise object\n\t\t\t\t\t\t\treturn $http( error.config );\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// After three timeouts, assume the network is down\n\t\t\t\t\t\t\terror.retryFailed = true;\n\t\t\t\t\t\t\terror.canceled = true;\n\n\t\t\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t}\n\t\t\t};\n\t\t} );\n\n\t\t// Inform Ionic we want to cache forward views\n\t\t$ionicConfigProvider.views.forwardCache( true );\n\t} )\n\n\t.filter( \"unique\", function() {\n\t\treturn function( items, filterOn ) {\n\t\t\tif ( filterOn === false ) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif ( ( filterOn || angular.isUndefined( filterOn ) ) && angular.isArray( items ) ) {\n\t\t\t\tvar newItems = [],\n\t\t\t\t\textractValueToCompare = function( item ) {\n\t\t\t\t\t\tif ( angular.isObject( item ) && angular.isString( filterOn ) ) {\n\t\t\t\t\t\t\treturn item[ filterOn ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tangular.forEach( items, function( item ) {\n\t\t\t\t\tvar isDuplicate = false;\n\n\t\t\t\t\tfor ( var i = 0; i < newItems.length; i++ ) {\n\t\t\t\t\t\tif ( angular.equals( extractValueToCompare( newItems[ i ] ), extractValueToCompare( item ) ) ) {\n\t\t\t\t\t\t\tisDuplicate = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( !isDuplicate ) {\n\t\t\t\t\t\tnewItems.push( item );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\titems = newItems;\n\t\t\t}\n\t\treturn items;\n\t\t};\n\t} )\n\n\t.directive( \"geoRuleSetup\", function( $rootScope, $filter ) {\n\t\treturn {\n\t\t\trestrict: \"E\",\n\t\t\treplace: true,\n\t\t\tscope: {\n\t\t\t\trule: \"=\"\n\t\t\t},\n\t\t\ttemplateUrl: \"templates/geoRuleSetup.html\",\n\t\t\tlink: function( scope, element ) {\n\t\t\t\tvar map, marker, circle;\n\n\t\t\t\tscope.updateRule = function() {\n\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\twindow.geofence.addOrUpdate( {\n\t\t\t\t\t\t\tid: scope.rule.direction + \"-\" + $rootScope.activeController.mac,\n\t\t\t\t\t\t\tlatitude: scope.rule.start.lat,\n\t\t\t\t\t\t\tlongitude: scope.rule.start.lng,\n\t\t\t\t\t\t\tradius: scope.rule.radius,\n\t\t\t\t\t\t\ttransitionType: scope.rule.direction === \"open\" ? 1 : 2,\n\t\t\t\t\t\t\tnotification: {\n\t\t\t\t\t\t\t\ttitle: \"OpenGarage Reminder\",\n\t\t\t\t\t\t\t\ttext: \"Tap here to \" + scope.rule.direction + \" the garage door...\",\n\t\t\t\t\t\t\t\topenAppOnClick: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tscope.updateMarker = function() {\n\t\t\t\t\tif ( marker ) {\n\t\t\t\t\t\tmarker.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tmarker = new google.maps.Marker( {\n\t\t\t\t\t\tposition: scope.rule.start,\n\t\t\t\t\t\tmap: map\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateRadius = function() {\n\t\t\t\t\tif ( circle ) {\n\t\t\t\t\t\tcircle.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tcircle = new google.maps.Circle( {\n\t\t\t\t\t\tstrokeColor: \"#FF0000\",\n\t\t\t\t\t\tstrokeOpacity: 0.8,\n\t\t\t\t\t\tstrokeWeight: 2,\n\t\t\t\t\t\tfillColor: \"#FF0000\",\n\t\t\t\t\t\tfillOpacity: 0.35,\n\t\t\t\t\t\tmap: map,\n\t\t\t\t\t\tcenter: scope.rule.start,\n\t\t\t\t\t\tradius: parseInt( scope.rule.radius )\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateMap = function() {\n\t\t\t\t\tif ( !scope.rule.enable ) {\n\t\t\t\t\t\twindow.geofence.remove( scope.rule.direction + \"-\" + $rootScope.activeController.mac, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\tmap = new google.maps.Map( element[ 0 ].querySelectorAll( \".map\" )[ 0 ], {\n\t\t\t\t\t\t\tzoom: 16,\n\t\t\t\t\t\t\tstreetViewControl: false,\n\t\t\t\t\t\t\tmapTypeControl: false,\n\t\t\t\t\t\t\tcenter: scope.rule.start\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tgoogle.maps.event.addListener( map, \"click\", function( e ) {\n\t\t\t\t\t\t\tscope.rule.start = { lat: e.latLng.lat(), lng: e.latLng.lng() };\n\t\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t}, 100 );\n\t\t\t\t};\n\n\t\t\t\tscope.$watch( \"rule\", function() {\n\t\t\t\t\tvar currentRule = $filter( \"filter\" )( $rootScope.geoFences, { \"id\": scope.rule.direction + \"-\" + $rootScope.activeController.mac } )[ 0 ];\n\n\t\t\t\t\tif ( currentRule ) {\n\t\t\t\t\t\tscope.rule.radius = currentRule.radius;\n\t\t\t\t\t\tscope.rule.start = { lat: currentRule.latitude, lng: currentRule.longitude };\n\t\t\t\t\t\tscope.rule.enable = true;\n\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscope.rule.radius = scope.rule.radius || 500;\n\t\t\t\t\t\tscope.rule.start = scope.rule.start || { lat: 30.296519, lng: -97.730185 };\n\t\t\t\t\t\tscope.rule.enable = scope.rule.enable || false;\n\n\t\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\t\tnavigator.geolocation.getCurrentPosition( function( position ) {\n\t\t\t\t\t\t\t\tscope.rule.start = { lat: position.coords.latitude, lng: position.coords.longitude };\n\t\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t\t}, { timeout: 10000 } );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t} );\n\n/* global angular, sjcl */\n\n// OpenGarage\nangular.module( \"opengarage.cloud\", [ \"opengarage.utils\" ] )\n    .factory( \"Cloud\", [ \"$injector\", \"$rootScope\", \"Utils\", function( $injector, $rootScope, Utils ) {\n\n        var requestAuth = function() {\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n                var scope = $rootScope.$new();\n                scope.data = {};\n\n                $ionicPopup.show( {\n                    templateUrl: \"templates/cloudLogin.html\",\n                    title: \"OpenGarage.io Login\",\n                    scope: scope,\n                    buttons: [\n                        { text: \"Cancel\" },\n                        {\n                            text: \"<b>Login</b>\",\n                            type: \"button-positive\",\n                            onTap: function( e ) {\n                                if ( !scope.data.username || !scope.data.password ) {\n                                    e.preventDefault();\n                                    return;\n                                }\n\n                                return true;\n                            }\n                        }\n                    ]\n                } ).then( function( isValid ) {\n                    if ( isValid ) {\n                        login( scope.data.username, scope.data.password, syncStart );\n                    }\n                } );\n            },\n            login = function( user, pass, callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                $http( {\n                    method: \"POST\",\n                    url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t},\n                    data: $httpParamSerializerJQLike( {\n                        action: \"ajaxLogin\",\n                        username: user,\n                        password: pass\n                    } )\n                } ).then( function( result ) {\n                    if ( typeof result.data.token === \"string\" ) {\n                        Utils.storage.set( {\n                            \"cloudToken\": result.data.token,\n                            \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( pass ) )\n                        } );\n                        $rootScope.isSynced = true;\n                    }\n                    callback( result.data.loggedin );\n                }, function() {\n                    callback( false );\n                } );\n            },\n            logout = function() {\n                Utils.storage.remove( \"cloudToken\" );\n                $rootScope.isSynced = false;\n            },\n            syncStart = function() {\n                $ionicActionSheet = $ionicActionSheet || $injector.get( \"$ionicActionSheet\" );\n\n                getSites( function( sites ) {\n                    if ( JSON.stringify( sites ) === JSON.stringify( $rootScope.controllers ) ) {\n                        return;\n                    }\n\n                    if ( Object.keys( sites ).length > 0 ) {\n\n                        var finish = function() {\n\t\t\t\t\t\t\t$rootScope.controllers = sites;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( sites ) }, saveSites );\n                            Utils.updateQuickLinks();\n                        };\n\n                        // Handle how to merge when cloud is populated\n                        $ionicActionSheet.show( {\n                            buttons: [\n                                { text: \"<i class='icon ion-merge'></i> Merge\" },\n                                { text: \"<i class='icon ion-ios-cloud-download'></i> Replace local with cloud\" },\n                                { text: \"<i class='icon ion-ios-cloud-upload'></i> Replace cloud with local\" }\n                            ],\n                            titleText: \"Select Merge Method\",\n                            cancelText: \"Cancel\",\n                            buttonClicked: function( index ) {\n                                if ( index === 1 ) {\n\n                                    // Replace local with cloud\n                                    finish();\n                                } else if ( index === 2 ) {\n\n                                    // Replace cloud with local\n                                    sites = $rootScope.controllers;\n                                    finish();\n                                } else {\n\t\t\t\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n                                    // Merge data\n                                    sites = $filter( \"unique\" )( $rootScope.controllers.concat( sites ), \"mac\" );\n                                    finish();\n                                }\n                                return true;\n                            }\n                        } );\n                    } else {\n                        saveSites();\n                    }\n                } );\n            },\n            sync = function( callback ) {\n                callback = callback || function() {};\n\n                Utils.storage.get( \"cloudToken\", function( local ) {\n                    if ( typeof local.cloudToken !== \"string\" ) {\n                        return;\n                    }\n\n                    getSites( function( data ) {\n                        if ( data !== false ) {\n                            $rootScope.controllers = data;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( data ) }, callback );\n                            Utils.updateQuickLinks();\n                        }\n                    } );\n                } );\n            },\n            getSites = function( callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( local ) {\n                    if ( local.cloudToken === undefined || local.cloudToken === null ) {\n                        callback( false );\n                        return;\n                    }\n\n                    if ( local.cloudDataToken === undefined || local.cloudDataToken === null ) {\n                        handleInvalidDataToken();\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        data: $httpParamSerializerJQLike( {\n                            action: \"getSites\",\n                            token: local.cloudToken,\n                            controllerType: \"opengarage\"\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false || result.data.sites === \"\" ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\": result.data.token } );\n                            var sites;\n\n                            try {\n                                sites = sjcl.decrypt( local.cloudDataToken, result.data.sites );\n                            } catch ( err ) {\n                                if ( err.message === \"ccm: tag doesn't match\" ) {\n                                    handleInvalidDataToken();\n                                }\n                                callback( false );\n                            }\n\n                            try {\n                                callback( JSON.parse( sites ) );\n                            } catch ( err ) {\n                                callback( false );\n                            }\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            saveSites = function( callback ) {\n\t\t\t\tif ( typeof callback !== \"function\" ) {\n\t                callback = function() {};\n\t\t\t\t}\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n                    if ( data.cloudToken === null || data.cloudToken === undefined ) {\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        suppressLoader: true,\n                        data: $httpParamSerializerJQLike( {\n                            action: \"saveSites\",\n                            token: data.cloudToken,\n                            controllerType: \"opengarage\",\n                            sites: encodeURIComponent( JSON.stringify( sjcl.encrypt( data.cloudDataToken, JSON.stringify( $rootScope.controllers ) ) ) )\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\": result.data.token } );\n                            callback( result.data.success );\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            handleInvalidDataToken = function() {\n                Utils.storage.remove( \"cloudDataToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.prompt( {\n                    title: \"Unable to read cloud data\",\n                    subTitle: \"Enter a valid password to decrypt the data\",\n                    template: \"Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.\",\n                    inputType: \"password\",\n                    inputPlaceholder: \"Password\"\n                } ).then( function( password ) {\n                    Utils.storage.set( {\n                        \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( password ) )\n                    } );\n                    sync();\n                } );\n            },\n            handleExpiredLogin = function() {\n                Utils.storage.remove( \"cloudToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.confirm( {\n                    title: \"OpenGarage.io Login Expired\",\n                    template: \"Click here to re-login to OpenGarage.io\"\n                } ).then( function( result ) {\n                    if ( result ) {\n\n                        requestAuth( function( result ) {\n                            if ( result === true ) {\n                                sync();\n                            }\n                        } );\n\n                    }\n                } );\n            },\n            getTokenUser = function( token ) {\n                return atob( token ).split( \"|\" )[ 0 ];\n            },\n            $http, $httpParamSerializerJQLike, $filter, $ionicPopup, $ionicActionSheet;\n\n        Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n\t\t\tif ( data.cloudToken === null || data.cloudToken === undefined || data.cloudDataToken === undefined || data.cloudDataToken === undefined ) {\n\t\t\t\t$rootScope.isSynced = false;\n\t\t\t} else {\n\t\t\t\t$rootScope.isSynced = true;\n\t\t\t}\n        } );\n\n        $rootScope.$on( \"controllersUpdated\", saveSites );\n\n        return {\n            requestAuth: requestAuth,\n            login: login,\n            logout: logout,\n            syncStart: syncStart,\n            sync: sync,\n            getSites: getSites,\n            saveSites: saveSites,\n            handleInvalidDataToken: handleInvalidDataToken,\n            handleExpiredLogin: handleExpiredLogin,\n            getTokenUser: getTokenUser\n        };\n    } ] );\n\n/* global angular, ionic */\n\nangular.module( \"opengarage.controllers\", [ \"opengarage.utils\", \"opengarage.cloud\" ] )\n\n\t.controller( \"LoginCtrl\", function( $scope, $rootScope, $state, $ionicPopup, Cloud ) {\n\t\t$scope.data = {};\n\n\t\t$scope.submit = function() {\n\t\t\tif ( !$scope.data.username ) {\n\n\t\t\t\t// If no email is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a username to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else if ( !$scope.data.password ) {\n\n\t\t\t\t// If no password is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a password to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tCloud.login( $scope.data.username, $scope.data.password, function() {\n\t\t\t\t\tCloud.sync( function() {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\t$scope.skipCloud = function() {\n\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t};\n\t} )\n\n\t.controller( \"ControllerSelectCtrl\", function( $scope, $state, $rootScope, $timeout, $filter, $ionicModal, $ionicHistory, Utils, Cloud ) {\n\t\t$scope.data = {\n\t\t\tshowDelete: false\n\t\t};\n\n\t\t$scope.selectPhoto = Utils.selectPhoto;\n\n\t\t$scope.setController = function( index ) {\n\t\t\tUtils.setController( index );\n\n\t\t\t$ionicHistory.nextViewOptions( {\n\t\t\t\thistoryRoot: true\n\t\t\t} );\n\n\t\t\t$state.go( \"app.home\" );\n\t\t};\n\n\t\t$scope.deleteController = function( index ) {\n\t\t\tif ( Utils.getControllerIndex() === index ) {\n\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\tUtils.storage.remove( \"activeController\" );\n\t\t\t}\n\n\t\t\t$rootScope.controllers.splice( index, 1 );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t};\n\n\t\t$scope.moveItem = function( item, fromIndex, toIndex ) {\n\t\t\t$rootScope.controllers.splice( fromIndex, 1 );\n\t\t\t$rootScope.controllers.splice( toIndex, 0, item );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t};\n\n\t\t$scope.getTime = function( timestamp ) {\n\t\t\treturn new Date( timestamp ).toLocaleString();\n\t\t};\n\n\t\t$scope.changeSync = function() {\n\t\t\tif ( $rootScope.isSynced ) {\n\t\t\t\tCloud.logout();\n\t\t\t} else {\n\t\t\t\tCloud.requestAuth();\n\t\t\t}\n\t\t};\n\t} )\n\n\t.controller( \"HistoryCtrl\", function( $scope, $filter, Utils ) {\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getLogs( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\tvar i, current, day;\n\n\t\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\t\tfor ( i = 0; i < reply.length; i++ ) {\n\t\t\t\t\t\tcurrent = new Date( reply[ i ][ 0 ] * 1000 ).toDateString();\n\n\t\t\t\t\t\tif ( current !== day ) {\n\t\t\t\t\t\t\tday = current;\n\t\t\t\t\t\t\treply.splice( i, 0, { isDivider: \"true\", day: current } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$scope.logs = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"SettingsCtrl\", function( $scope, $state, $ionicPopup, Utils ) {\n\t\t$scope.settings = {};\n\n\t\t$scope.changePassword = Utils.changePassword;\n\t\t$scope.restart = Utils.restartController;\n\n\t\t$scope.submit = function() {\n\t\t\tUtils.saveOptions( $scope.settings, function( reply ) {\n\t\t\t\tvar text;\n\n\t\t\t\tif ( reply ) {\n\t\t\t\t\ttext = \"Settings saved successfully!\";\n\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t} else {\n\t\t\t\t\ttext = \"Unable to save settings. Please check the connection to the device and try again.\";\n\t\t\t\t}\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>\" + text + \"</p>\"\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getControllerOptions( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\t\t// Remove unused options to prevent accidental change\n\t\t\t\t\tdelete reply.mod;\n\t\t\t\t\tdelete reply.fwv;\n\t\t\t\t\t$scope.settings = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t}, null, true );\n\t\t} );\n\t} )\n\n\t.controller( \"MenuCtrl\", function( $scope, $rootScope, $ionicActionSheet, $ionicPopup, $ionicSideMenuDelegate, $timeout, Utils ) {\n\n\t\t$scope.sideMenuDraggable = Utils.getControllerIndex() === 0 ? true : false;\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$scope.sideMenuDraggable = Utils.getControllerIndex() === 0 ? true : false;\n\t\t} );\n\n\t\t$scope.showAddController = function() {\n\t\t\t$ionicActionSheet.show( {\n\t\t\t\tbuttons: [\n\t\t\t\t\t{ text: \"<i class='icon ion-plus-circled'></i> Add by IP\" },\n\t\t\t\t\t{ text: \"<i class='icon ion-network'></i> Add by Blynk Token\" },\n\t\t\t\t\t{ text: \"<i class='icon ion-ios-color-wand'></i> Setup New Device\" }\n\t\t\t\t],\n\t\t\t\ttitleText: \"Add Controller\",\n\t\t\t\tcancelText: \"Cancel\",\n\t\t\t\tbuttonClicked: function( index ) {\n\t\t\t\t\tif ( index === 1 ) {\n\t\t\t\t\t\tUtils.showAddBlynk();\n\t\t\t\t\t} else if ( index === 0 ) {\n\t\t\t\t\t\tUtils.showAddController();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tUtils.checkNewController( function( result ) {\n\t\t\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Please first connect the power to your OpenGarage. Once complete, connect this device to the wifi network broadcast by the OpenGarage (named OG_XXXXXX) and reopen this app.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, false );\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\t// Function to close the menu which is fired after a side menu link is clicked.\n\t\t// This is done instead of using the menu-close directive to preserve the root history stack\n\t    $scope.closeMenu = function() {\n            $ionicSideMenuDelegate.toggleLeft( false );\n\t    };\n\t} )\n\n\t.controller( \"HomeCtrl\", function( $rootScope, $scope, $filter, $http, $timeout, Utils ) {\n        var interval;\n\n\t\t$scope.toggleDoor = Utils.toggleDoor;\n\t\t$scope.selectPhoto = Utils.selectPhoto;\n\t\t$scope.currentIndex = Utils.getControllerIndex();\n\n\t\t$scope.changeController = function( direction ) {\n\t\t\tvar current = Utils.getControllerIndex(),\n\t\t\t\tto = current + direction;\n\n\t\t\tif ( current === -1 || to < 0 || to >= $rootScope.controllers.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$scope.currentIndex = to;\n\t\t\tUtils.setController( to );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeLeave\", function() {\n\t\t\tclearInterval( interval );\n\t\t} );\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n            interval = setInterval( Utils.updateController, 5000 );\n        } );\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$scope.currentIndex = Utils.getControllerIndex();\n\t\t\t$timeout( function() {\n\t\t\t\t$scope.$apply();\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"RulesCtrl\", function( $scope, $rootScope ) {\n\t\tvar reset = function() {\n\t\t\t$scope.geo = {\n\t\t\t\thome: { direction: \"open\" },\n\t\t\t\taway: { direction: \"close\" }\n\t\t\t};\n\t\t\t$scope.set( \"home\" );\n\t\t};\n\n\t\t$scope.isAndroid = ionic.Platform.isAndroid();\n\n\t\t$scope.set = function( type ) {\n\t\t\tif ( type === \"home\" ) {\n\t\t\t\t$scope.current = $scope.geo.home;\n\t\t\t} else {\n\t\t\t\t$scope.current = $scope.geo.away;\n\t\t\t}\n\t\t};\n\n\t\t$rootScope.$on( \"controllerUpdated\", reset );\n\t\treset();\n\t} );\n\n/* global angular, window */\n\n// OpenGarage\nangular.module( \"opengarage.utils\", [] )\n    .factory( \"Utils\", [ \"$injector\", \"$rootScope\", function( $injector, $rootScope ) {\n\n\t\tvar isFireFox = /Firefox/.test( window.navigator.userAgent ),\n\t\t\tisIE = /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ),\n\n\t        // Define storage wrapper functions\n\t        storage = {\n\t            get: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var data = {},\n                        i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            data[ query[ i ] ] = localStorage.getItem( query[ i ] );\n                        }\n                    }\n\n                    callback( data );\n\t            },\n\t            set: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n                    if ( typeof query === \"object\" ) {\n                        for ( i in query ) {\n                            if ( query.hasOwnProperty( i ) ) {\n                                localStorage.setItem( i, query[ i ] );\n                            }\n                        }\n                    }\n\n                    callback( true );\n\t            },\n\t            remove: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            localStorage.removeItem( query[ i ] );\n                        }\n                    }\n\n                    callback( true );\n\t            }\n\t        },\n\t\t\tintToIP = function( int ) {\n\t\t\t\treturn ( int % 256 ) + \".\" + ( ( int / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) / 256 >> 0 );\n\t\t\t},\n\t        getControllerSettings = function( callback, ip, token ) {\n\t\t\t\tif ( !ip && !token && !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n                $q = $q || $injector.get( \"$q\" );\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\tpromise = $q.all( {\n                        name: $http( {\n                            method: \"POST\",\n                            url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n                            headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n                            data: \"action=blynkCloud&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/project\",\n                            suppressLoader: true\n                        } ),\n                        door: $http( {\n                            method: \"POST\",\n                            url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n                            headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n                            data: \"action=blynkCloud&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/get/V0\",\n                            suppressLoader: true\n                        } )\n                    } );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\turl: \"http://\" + ( ip || $rootScope.activeController.ip ) + \"/jc\",\n\t\t\t\t\t\tsuppressLoader: ip ? false : true\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\t\t\tif ( result.name.data === \"Invalid token.\" ) {\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcallback( {\n\t\t\t\t\t\t\t\tname: result.name.data.name,\n\t\t\t\t\t\t\t\tdoor: parseInt( result.door.data[ 0 ] ) === 255 ? 1 : 0,\n\t\t\t\t\t\t\t\tlastUpdate: result.name.data.updatedAt\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.data.lastUpdate = new Date().getTime();\n\t\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        getControllerOptions = function( callback, ip, showLoader ) {\n\t\t\t\tif ( ( !ip && !$rootScope.activeController ) || ( $rootScope.activeController && !$rootScope.activeController.ip ) ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + ( ip || $rootScope.activeController.ip ) + \"/jo\",\n                    suppressLoader: showLoader ? false : true\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        updateController = function() {\n\t\t\t\tvar controller = angular.copy( $rootScope.activeController ) || {};\n\n\t\t\t\treturn getControllerSettings( function( data ) {\n                    if ( data === false ) {\n                        $rootScope.connected = false;\n                        return;\n                    }\n\n                    $rootScope.connected = true;\n                    angular.extend( controller, data );\n                } ).then( function() {\n                    var index = getControllerIndex();\n\n                    if ( index >= 0 && controller.mac === $rootScope.activeController.mac ) {\n                        $rootScope.controllers[ index ] = controller;\n                        $rootScope.activeController = controller;\n                        $rootScope.$broadcast( \"controllerUpdated\" );\n                        $rootScope.$broadcast( \"controllersUpdated\" );\n                        storage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n                    }\n                } );\n\t        },\n\t        getControllerIndex = function( mac ) {\n\t\t\t\tif ( !$rootScope.activeController && !mac ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tmac = mac || ( $rootScope.activeController === null ? \"\" : $rootScope.activeController.mac );\n\n\t\t\t\tfor ( var i = 0; i < $rootScope.controllers.length; i++ ) {\n\t\t\t\t\tif ( $rootScope.controllers[ i ].mac === mac ) {\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t        },\n\t        setController = function( controller, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\n\t\t\t\tcancelPendingHttp();\n\t\t\t\t$rootScope.activeController = typeof controller === \"object\" ? controller : $rootScope.controllers[ controller ];\n\t\t\t\t$rootScope.connected = false;\n\t\t\t\tupdateController();\n\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) }, callback );\n\t\t\t\tupdateQuickLinks();\n\t        },\n\t\t\taddController = function( data, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( !data.token && ( !data.ip || !data.password ) ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Both an IP and password are required.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( data.token && data.token.length !== 32 ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>A valid Blynk token is required. Please verify your token and try again.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tgetControllerSettings( function( result ) {\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to find device. Please verify the IP/password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\n                    $filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\t\tif ( result.mac ) {\n\t\t\t\t\t\tresult.ip = data.ip;\n\t\t\t\t\t\tresult.password = data.password;\n\n\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgetControllerOptions( function( reply ) {\n\t\t\t\t\t\t\tangular.extend( result, reply );\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t}, data.ip );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.token ) {\n\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + data.token + \"/get/V2\",\n\t\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t\t} ).then( function( reply ) {\n\t\t\t\t\t\t\tif ( reply.data === \"Invalid token.\" ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid Blynk token.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treply = reply.data.pop().split( \" \" )[ 1 ].split( \"_\" )[ 1 ];\n\t\t\t\t\t\t\tresult.mac = \"5C:CF:7F:\" + reply.match( /.{1,2}/g ).join( \":\" );\n\t\t\t\t\t\t\tresult.auth = data.token;\n\n\t\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdata.token ? null : data.ip,\n\t\t\t\tdata.token ? data.token : null\n\t\t\t\t);\n\t\t\t},\n\t\t\tcheckNewController = function( callback, suppressLoader ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/js\",\n\t                suppressLoader: typeof suppressLoader !== \"undefined\" ? suppressLoader : true,\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tretryCount: 3\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( !result.data.ssids ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\t\t\tscope.data = {};\n\t\t\t\t\t\tscope.save = function() {\n\t\t\t\t\t\t\tscope.modal.hide();\n\t\t\t\t\t\t\tconnectNewController( scope.data );\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.ssids = result.data.ssids;\n\t\t\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/newControllerSetup.html\", {\n\t\t\t\t\t\t\tscope: scope,\n\t\t\t\t\t\t\tanimation: \"slide-in-up\"\n\t\t\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\t\t\tscope.modal = modal;\n\t\t\t\t\t\t\tmodal.show();\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tconnectNewController = function( data ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/cc?ssid=\" + encodeURIComponent( data.ssid ) + \"&pass=\" + encodeURIComponent( data.password )\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( result.data.result === 1 ) {\n\t\t\t\t\t\t\tsetTimeout( saveNewController, 2000 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid SSID/password combination. Please try again.</p>\"\n\t\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to reach controller. Please try again.</p>\"\n\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tsaveNewController = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/jt\"\n\t            } ).then( function( result ) {\n\t\t\t\t\tif ( result.data.ip === 0 ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Controller was unable to connect. Please check your SSID and password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Controller succesfully connected! Please wait while the device reboots.</p>\"\n\t\t\t\t\t} );\n\n\t\t\t\t\t$rootScope.controllers.push( {\n\t\t\t\t\t\tip: intToIP( result.data.ip ),\n\t\t\t\t\t\tpassword: \"opendoor\",\n\t\t\t\t\t\tname: \"My OpenGarage\"\n\t\t\t\t\t} );\n\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tscanLocalNetwork = function( callback ) {\n\t\t\t\tif ( !window.networkinterface ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.networkinterface.getIPAddress( function( router ) {\n\t\t\t\t\tif ( !router ) {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t\trouter = router.split( \".\" );\n\t\t\t\t\trouter.pop();\n\n\t\t\t\t\tvar baseip = router.join( \".\" ),\n\t\t\t\t\t\tcheck = function( ip ) {\n\t\t\t\t\t\t\treturn $http( {\n\t\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\t\turl: \"http://\" + baseip + \".\" + ip + \"/jc\",\n\t\t\t\t\t\t\t\t\tsuppressLoader: true,\n\t\t\t\t\t\t\t\t\ttimeout: 6000,\n\t\t\t\t\t\t\t\t\tretryCount: 3\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.then( function( result ) {\n\t\t\t\t\t\t\t\t\tif ( result.data && result.data.mac ) {\n\t\t\t\t\t\t\t\t\t\tmatches.push( baseip + \".\" + ip );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.catch( function() {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tqueue = [], matches = [], i;\n\n\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\n\t\t\t\t    for ( i = 1; i <= 244; i++ ) {\n\t\t\t\t        queue.push( check( i ) );\n\t\t\t\t    }\n\n\t\t\t\t    $q.all( queue ).then( function() {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\tcallback( matches );\n\t\t\t\t    } );\n\t\t\t\t} );\n\t\t\t},\n\t\t\trequestPassword = function( callback ) {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Enter Controller Password\",\n\t\t\t\t\ttemplate: \"Enter your controller's password below:\",\n\t\t\t\t\tinputType: \"password\",\n\t\t\t\t\tinputPlaceholder: \"Controller Password\"\n\t\t\t\t} ).then( function( password ) {\n\t\t\t\t\tcallback( password );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tupdateQuickLinks = function() {\n\t\t\t\tif ( !window.ThreeDeeTouch ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.ThreeDeeTouch.isAvailable( function( isAvailable ) {\n\t\t\t\t\tif ( !isAvailable || !$rootScope.controllers.length ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar links = [],\n\t\t\t\t\t\tlimit = $rootScope.controllers.length < 4 ? $rootScope.controllers.length : 4;\n\n\t\t\t\t\tfor ( var i = 0; i < limit; i++ ) {\n\t\t\t\t\t\tlinks.push( {\n\t\t\t\t\t\t\ttype: \"toggle-\" + $rootScope.controllers[ i ].mac,\n\t\t\t\t\t\t\ttitle: \"Toggle \" + $rootScope.controllers[ i ].name,\n\t\t\t\t\t\t\ticonType: \"Update\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.ThreeDeeTouch.configureQuickActions( links );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tcancelPendingHttp = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\t$http.pendingRequests.forEach( function( pendingReq ) {\n\t\t\t\t\tif ( pendingReq.cancel ) {\n\t\t\t\t\t\tpendingReq.cancel.resolve();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\t$http, $q, $filter, $ionicPopup, $ionicModal;\n\n\t    if ( isFireFox ) {\n\t\t\tHTMLElement.prototype.click = function() {\n\t\t\t\tvar evt = this.ownerDocument.createEvent( \"MouseEvents\" );\n\t\t\t\tevt.initMouseEvent( \"click\", true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null );\n\t\t\t\tthis.dispatchEvent( evt );\n\t\t\t};\n\t    }\n\n        $rootScope.$on( \"controllersUpdated\", updateQuickLinks );\n\n\t    // Return usable functions\n\t    return {\n\t\t\tisIE: isIE,\n\t        storage: storage,\n\t        getControllerSettings: getControllerSettings,\n\t        getControllerOptions: getControllerOptions,\n\t        updateController: updateController,\n\t        setController: setController,\n\t        getControllerIndex: getControllerIndex,\n\t        checkNewController: checkNewController,\n\t        updateQuickLinks: updateQuickLinks,\n\t\t\tshowAddController: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.data = {\n\t\t\t\t\tcanScan: window.networkinterface ? true : false\n\t\t\t\t};\n\t\t\t\tscope.scan = function() {\n\t\t\t\t\tscanLocalNetwork( function( result ) {\n\t\t\t\t\t\tif ( !result || !result.length ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>No devices detected on your network</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscope.data.foundControllers = result;\n\t\t\t\t\t} );\n\t\t\t\t};\n\t\t\t\tscope.save = function( ip ) {\n\t\t\t\t\tpopup.close();\n\t\t\t\t\trequestPassword( function( password ) {\n\t\t\t\t\t\taddController( {\n\t\t\t\t\t\t\tip: ip,\n\t\t\t\t\t\t\tpassword: password\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tvar popup = $ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/addController.html\",\n\t\t\t\t\ttitle: \"Add Controller\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Add</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\",\n\t\t\t\t\t\t\tonTap: function( e ) {\n\t\t\t\t\t\t\t\tif ( !scope.data.ip || !scope.data.password ) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} );\n\n\t\t\t\tpopup.then(\n\t\t\t\t\tfunction( isValid ) {\n\t\t\t\t\t\tif ( isValid ) {\n\t\t\t\t\t\t\taddController( scope.data, callback );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tshowAddBlynk: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Add Controller by Blynk\",\n\t\t\t\t\ttemplate: \"Enter your Blynk Auth token below:\",\n\t\t\t\t\tinputType: \"text\",\n\t\t\t\t\tinputPlaceholder: \"Your Blynk Auth token\"\n\t\t\t\t} ).then( function( token ) {\n\t\t\t\t\tif ( token ) {\n\t\t\t\t\t\taddController( { token: token }, callback );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\ttoggleDoor: function( auth, callback ) {\n\t\t\t\tif ( typeof auth === \"function\" ) {\n\t\t\t\t\tcallback = auth;\n\t\t\t\t\tauth = null;\n\t\t\t\t}\n\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( auth || ( $rootScope.activeController && $rootScope.activeController.auth ) ) {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( ( auth || $rootScope.activeController.auth ) + \"/update/V1?value=1\" )\n\t\t\t\t\t} ).then( function() {\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t                suppressLoader: true,\n\t\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + encodeURIComponent( ( auth || $rootScope.activeController.auth ) + \"/update/V1?value=0\" )\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}, $rootScope.activeController.cdt || 1000 );\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http.get( \"http://\" + $rootScope.activeController.ip + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&click=1\" );\n\t\t\t\t}\n\n\t            promise.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\trestartController: function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t$ionicPopup.confirm( {\n\t\t\t\t\t\ttitle: \"Restart Controller?\",\n\t\t\t\t\t\ttemplate: \"<p class='center'>Are you sure you want to restart the controller?</p>\"\n\t\t\t\t\t} ).then( function( result ) {\n\t\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t\t$http.get( \"http://\" + $rootScope.activeController.ip + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&reboot=1\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsaveOptions: function( settings, callback ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + $rootScope.activeController.ip + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\tparams: settings,\n\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tchangePassword: function() {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.pwd = {};\n\n\t\t\t\t$ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/changePassword.html\",\n\t\t\t\t\ttitle: \"Change Password\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Go</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} ).then( function() {\n\t\t\t\t\tif ( !scope.pwd.nkey || !scope.pwd.ckey || scope.pwd.nkey !== scope.pwd.ckey  ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    $http = $http || $injector.get( \"$http\" );\n                    $filter = $filter || $injector.get( \"$filter\" );\n\n\t\t            $http( {\n\t\t                method: \"GET\",\n\t\t                url: \"http://\" + $rootScope.activeController.ip + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\t\tparams: scope.pwd,\n\t\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t\t            } ).then( function() {\n\t\t\t\t\t\t$rootScope.activeController.password = scope.pwd.nkey;\n\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Password updated succesfully!</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tgetLogs: function( callback ) {\n\t\t\t\tif ( !$rootScope.activeController || !$rootScope.activeController.ip ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://\" + $rootScope.activeController.ip + \"/jl\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data.logs.sort( function( a, b ) { return b[ 0 ] - a[ 0 ]; } ) );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tselectPhoto: function( $event, index, deletePhoto ) {\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t\t\t\tvar scope = $rootScope.$new(),\n\t\t\t\t\tfileInput = angular.element( document.getElementById( \"photoUpload\" ) );\n\n\t\t\t\tscope.data = {\n\t\t\t\t\timage: false,\n\t\t\t\t\tcropped: false,\n\t\t\t\t\tindex: false\n\t\t\t\t};\n\n\t\t\t\tscope.uploadPhoto = function( index ) {\n\t\t\t\t\tscope.crop.hide();\n\n\t\t\t\t\tif ( getControllerIndex() === index ) {\n\t\t\t\t\t\t$rootScope.activeController.image = scope.data.cropped;\n\t\t\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\t$rootScope.controllers[ index ].image = scope.data.cropped;\n\t\t\t        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t        $rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t};\n\n\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/crop.html\", {\n\t\t\t\t\tscope: scope\n\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\tscope.crop = modal;\n\t\t\t\t} );\n\n\t\t\t\t$event.stopPropagation();\n\n\t\t\t\tif ( deletePhoto ) {\n\t\t\t\t\tif ( getControllerIndex() === index ) {\n\t\t\t\t\t\tdelete $rootScope.activeController.image;\n\t\t\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\tdelete $rootScope.controllers[ index ].image;\n\t\t\t        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t        $rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfileInput.parent()[ 0 ].reset();\n\n\t\t\t\tfileInput.one( \"change\", function() {\n\t\t\t\t\tvar file = fileInput[ 0 ].files[ 0 ];\n\n\t\t\t\t\tif ( !file.type || !file.type.match( \"image.*\" ) ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.onload = function( evt ) {\n\t\t\t\t\t\tscope.data.image = evt.target.result;\n\t\t\t\t\t\tscope.data.index = index;\n\t\t\t\t\t\tscope.crop.show();\n\t\t\t\t\t};\n\t\t\t\t\treader.readAsDataURL( file );\n\t\t\t\t} );\n\n\t\t\t\tfileInput[ 0 ].click();\n\t\t\t}\n\t    };\n} ] );\n\n/* global angular */\n\n// OpenGarage\nangular.module( \"opengarage.watch\", [] )\n    .factory( \"Watch\", [ \"$injector\", \"$rootScope\", function( $injector, $rootScope ) {\n\n\t\tvar loadApp = function() {\n            window.applewatch.loadAppMain( {\n                title: \"OpenGarage\",\n                label: {\n                    value: \"Toggle Garage Door\",\n                    color: \"#FFA500\",\n                    font: {\n                        size: 12\n                    }\n                },\n                table: {\n                    callback: \"toggleDoorByIndex\",\n                    alpha: 1,\n                    rows: makeAppList()\n                }\n            } );\n        },\n        makeAppList = function() {\n            var rows = [];\n\n            $rootScope.controllers.forEach( function( controller ) {\n\t\t\t\tvar item = {\n                    type: \"OneColumnSelectableRowType\",\n                    group: {\n                        backgroundColor: \"#1884C4\",\n                        cornerRadius: 8\n                    },\n                    label: {\n                        value: \" \" + controller.name\n                    }\n                };\n\n                if ( controller.image ) {\n\n\t\t\t\t\tvar canvas = document.createElement( \"canvas\" ),\n\t\t\t\t\t\tctx = canvas.getContext( \"2d\" ),\n\t\t\t\t\t\timg = new Image();\n\n\t\t\t\t\timg.src = controller.image;\n\n\t\t\t\t\tcanvas.width = 25;\n\t\t\t\t\tcanvas.height = 30;\n\t\t\t\t\tctx.drawImage( img, 0, 0, canvas.width, canvas.height );\n\n\t\t\t\t\titem.imageLeft = {\n                        data: canvas.toDataURL( \"image/png\" ),\n                        width: canvas.width,\n                        height: canvas.height\n                    };\n                }\n\n                rows.push( item );\n            } );\n\n            return rows;\n        };\n\n        $rootScope.$on( \"controllersUpdated\", function() {\n            if ( window.applewatch ) {\n                loadApp();\n            }\n        } );\n\n        return {\n            loadApp: loadApp\n        };\n    } ] );\n"]}